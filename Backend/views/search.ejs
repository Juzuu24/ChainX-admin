<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('component/head') %>
  <title><%= title %></title>
</head>
<body>
  <%- include('component/nav') %>

  <div class="main-container">
    <%- include('component/sidebar') %>

    <div class="content">
      <h2 class="mb-3">Search results for “<%= q %>”</h2>

      <!-- Users -->
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-white fw-semibold">Users</div>
        <div class="card-body p-0">
          <table class="custom-table m-0" style="width:100%">
            <thead><tr><th>ID</th><th>Username</th><th>Phone</th><th>Email</th><th>Balance</th><th>Password Hash</th><th>VIP Status</th><th>Credit Score</th><th>Created At</th><th>Actions</th></tr></thead>
            <tbody>
              <% if (users && users.length) { %>
                <% users.forEach(u => { %>
                  <tr>
                    <td><%= u.id %></td>
                    <td><%= u.username %></td>
                    <td><%= u.phone_number %></td>
                    <td><%= u.email %></td>
                    <td>$<%= Number(u.balance).toFixed(2) %></td>
                    <td><%= u.password_hash %></td>
                    <td><%= u.vip_status %></td>
                    <td><%= u.credit_score %></td>
                    <td><%= (u.created_at instanceof Date) ? u.created_at.toISOString().slice(0,19).replace('T',' ') : u.created_at %></td>
                    <td>
                      <div class="action-buttons">
                        <a class="btn btn-warning btn-sm" href="/users/edit/<%= u.id %>">Edit</a>
                        <a class="btn btn-danger btn-sm" href="/users/delete/<%= u.id %>" onclick="return confirm('Delete this user?')">Delete</a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="10" class="text-center p-3">No matching users</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>



      <!-- Withdrawals -->
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-white fw-semibold">Withdrawals</div>
        <div class="card-body p-0">
          <table class="custom-table m-0" style="width:100%">
            <thead><tr><th>ID</th><th>User</th><th>Amount</th><th>Method</th><th>Account</th><th>Holder Name</th><th>Phone Number</th><th>Crypto ID</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
              <% if (withdrawals && withdrawals.length) { %>
                <% withdrawals.forEach(w => { %>
                  <tr>
                    <td><%= w.withdraw_id %></td>
                    <td><%= w.username ?? w.user_id %></td>
                    <td>$<%= Number(w.amount).toFixed(2) %></td>
                    <td><%= w.method %></td>
                    <td><%= w.account %></td>
                    <td><%= w.holderName %></td>
                    <td><%= w.phoneNumber %></td>
                    <td><%= w.cryptoId %></td>
                    <td><%= (w.created_at instanceof Date) ? w.created_at.toISOString().slice(0,19).replace('T',' ') : w.created_at %></td>
                    <td><%= w.status %></td>
                    <td>
                      <div class="action-buttons">
                        <a class="btn btn-warning btn-sm" href="/withdrawals/edit/<%= w.withdraw_id %>">Edit</a>
                        <a class="btn btn-danger btn-sm" href="/withdrawals/delete/<%= w.withdraw_id %>" onclick="return confirm('Delete this withdrawal?')">Delete</a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="11" class="text-center p-3">No matching withdrawals</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Lucky Orders -->
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-white fw-semibold">Lucky Orders</div>
        <div class="card-body p-0">
          <table class="custom-table m-0" style="width:100%">
            <thead><tr><th>ID</th><th>User</th><th>Order Number</th><th>Claimed</th><th>Created At</th><th>Actions</th></tr></thead>
            <tbody>
              <% if (settings && settings.length) { %>
                <% settings.forEach(order => { %>
                  <tr>
                    <td><%= order.id %></td>
                    <td><%= order.username %></td>
                    <td><%= order.order_number %></td>
                    <td><%= order.is_claimed ? 'Yes' : 'No' %></td>
                    <td><%= (order.created_at instanceof Date) ? order.created_at.toISOString().slice(0,19).replace('T',' ') : order.created_at %></td>
                    <td>
                      <div class="action-buttons">
                        <a class="btn btn-warning btn-sm" href="/order/edit/<%= order.id %>">Edit</a>
                        <form method="POST" action="/order/delete/<%= order.id %>" style="display:inline;">
                          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete this lucky order?')">Delete</button>
                        </form>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="6" class="text-center p-3">No matching lucky orders</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
